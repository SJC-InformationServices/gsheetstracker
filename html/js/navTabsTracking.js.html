<script>
  google.script.run.withSuccessHandler(renderDataTable).withFailureHandler(failedDataTable).getDataTableContents("TRACKING");
  google.script.run.withSuccessHandler(renderDataTable).withFailureHandler(failedDataTable).getDataTableContents("IMAGES");
  google.script.run.withSuccessHandler(renderDataTable).withFailureHandler(failedDataTable).getDataTableContents("PRODUCTS");
  google.script.run.withSuccessHandler(renderDataTable).withFailureHandler(failedDataTable).getDataTableContents("OFFERS");
</script>

<script>
  var $merchin = $('#merchin'),
    $merchout = $('#merchout');
    var dataTables = {};
    dataTables.TRACKING = $('#TRACKINGTABLE').DataTable();
    dataTables.OFFERS = $('#OFFERSTABLE').DataTable();
    dataTables.PRODUCTS = $('#PRODUCTSTABLE').DataTable();
    dataTables.IMAGES = $('#IMAGESTABLE').DataTable();

  function submitComplete(o,obj) {
    console.dir(this);
    console.dir(o);
    console.dir(obj);
    try{
    var tbl = o.tableId;
    var dt = dataTables(o.type).addRow(o.rec).draw();
    }catch(e){
      console.log('error: ' + e.message);
      //console.dir(e);
    }
    
  }
  function submitFailed(o){
    //console.dir(o);
  }

  $merchin.on('submit', function (e) {
    e.preventDefault();
    var d = new Date();

    var obj = {
      type: "TRACKING",
      rec: {
        IN_SJC: [
          d.getFullYear(),
          d.getMonth() + 1,
          d.getDate()
        ].join('/') + ' ' + [d.getHours(),
          d.getMinutes()
        ].join(':')
      }
    };
    var rec = $(this).serializeArray();

    for (var i = 0; i < rec.length; i++) {
      var n = rec[i].name;
      var v = rec[i].value;
      obj.rec[n] = v;
    }
    google.script.run.withSuccessHandler(submitComplete).withUserObject(dataTables).insertRecord(obj);
  });

  $merchout.on('submit', function (e) {
    e.preventDefault();
    var obj = {};
    obj.type = "TRACKING";

    var d = new Date();
    obj.IN_SJC = [
      d.getFullYear(),
      d.getMonth() + 1,
      d.getDate()
    ].join('/') + ' ' + [d.getHours(),
      d.getMinutes()
    ].join(':');

    var rec = $(this).serializeArray();
    for (var i = 0; i < rec.length; i++) {
      var n = rec[i].name;
      var v = rec[i].value;
      obj[n] = v;
    }
    google.script.run.withSuccessHandler(submitComplete).insertRecord(obj);
  });
</script>
